const subdomainsRedirections = {
  "citizendao.earth": {
    drive:
      "https://drive.google.com/drive/folders/1TqHruYroZDoVvDXOgz8823E5GofxHSeH",
  },
  "citizenwallet.xyz": {
    zoom: "https://us06web.zoom.us/j/5686896709",
    signal:
      "https://signal.group/#CjQKIK7lRZGN89uFUJqZ31npeVKbVHfo5Z15yl9XFoAeh2OrEhDfnmWNlW98l-OpBKzAnPET",
    drive: "https://drive.google.com/open?id=16fm3DNfOsL7HJ_uz4DuL9krNRh72YoRS",
    miro: "http://miro.com/app/board/uXjVMd0Js_E=/",
    wireframes:
      "https://www.figma.com/file/bH8gD0i9xsPsHyXKga67LT/wireframes?type=design&node-id=0-1&mode=design&t=Htqwd5dMKDZfDtiz-0",
    figma:
      "https://www.figma.com/file/qwtJ5S8VDWMVvxRqgCvLrE/branding?type=design&mode=design&t=SGJAkygqco9TtzkP-0",
    calendar:
      "https://calendar.google.com/calendar/embed?src=c19265b9b3f270a100ed7ddf0c077dbedae83f84f439186e0996e0c71b7365f6%40group.calendar.google.com&ctz=Europe%2FBrussels",
    deck: "https://drive.google.com/open?id=1OOxDEpbNXj_PI9cqnOre6SkEdqBTDxAz",
    tasks: "https://app.dework.xyz/citizenwallet",
    discord: "https://discord.gg/fsdmswqqMm",
    telegram: "https://t.me/+r5kF0wZQ3643OWIx",
  },
  "citizencorner.brussels": {
    calendar:
      "https://calendar.google.com/calendar/embed?src=apc0sg19i1ic703d5g1d53tpss%40group.calendar.google.com&ctz=Europe%2FBrussels",
    drive:
      "https://drive.google.com/drive/folders/10F8oO59nZo_Yja8Fz8utGDinCuB8VQe8?usp=sharing",
    facebook: "https://facebook.com/citizencornerbxl",
    donate: "https://opencollective.com/citizencorner/donate",
    map: "https://goo.gl/maps/jXiHm57z77CLxURh8",
    budget: "https://opencollective.com/citizencorner",
    discord: "https://discord.gg/xyxQhRft8x",
    whatsapp: "https://chat.whatsapp.com/GWPZyBseJalHomDjIFu1sm",
  },
  "citizenspring.earth": {
    zoom: "https://us06web.zoom.us/j/5686896709",
    zinne: "https://zinne.glide.page",
    drive: "https://drive.google.com/drive/folders/0AOI4BBfAd3WXUk9PVA",
  },
  "commonshub.brussels": {
    zoom: "https://us06web.zoom.us/j/5686896709",
    whatsapp: "https://chat.whatsapp.com/H7yLf16yiVrHInK7XpfEg3",
    deck: "https://docs.google.com/presentation/d/135POHqxUFv_G0_lZHTc7prTs1pvxm-40f02QiZbvPqU/edit?usp=sharing",
    figma:
      "https://www.figma.com/board/wz3aTgdY8PGO0hEtefUGlI/White-board?node-id=0%3A1&t=eSeBuoTSzi4ywvgm-1",
    drive:
      "https://drive.google.com/drive/u/0/folders/1Iy9xZm7vwg5YwAU0gh6xSoM6cNPH6Ye4",
  },
  "dao.brussels": {
    drive:
      "https://drive.google.com/drive/folders/1r3kSwu8_w4ju0fn5TQOhg7HCQW2XwnmH",
    discord: "https://discord.gg/awfSTf6EHK",
    whatsapp: "https://chat.whatsapp.com/JQ4fttn0KEH79xAyryYs4e",
    zoom: "https://us06web.zoom.us/j/5686896709",
    figma:
      "https://www.figma.com/file/j650orH4LNkssEydb2bcfc/DAO.Brussels-whiteboard?type=whiteboard&node-id=0%3A1&t=BhsrA01iVaWUV3rp-1",
    telegram: "https://t.me/joinchat/5NbP0-Vl5Vg3MTgx",
    photos: "https://photos.app.goo.gl/f921RyUyJAEAUy7S8",
    wallet: "https://dao.brussels/wallet",
    notion:
      "https://www.notion.so/daobrussels/DAO-Brussels-e84bb3439d174a21a64bea071d266e8d",
    calendar:
      "https://calendar.google.com/calendar/embed?src=haijn9je0u2ci9efj7g0it8tk4%40group.calendar.google.com&ctz=Europe%2FBrussels",
  },
  "regensunite.earth": {
    notion: "https://notion.so/regensunite",
    figma:
      "https://www.figma.com/file/3E7rdQwyLe29SY8OeIaHdB/RU-Brand-%2F-Website?type=design&node-id=188%3A3554&mode=design&t=n1XGGcyrz50Iid7i-1",
    drive:
      "https://drive.google.com/drive/u/0/folders/10MMk0j6A1cMOSDIRdWxv0FCSwHXg7sAE",
    calendar:
      "https://calendar.google.com/calendar/embed?src=729ti6j2pin4og5kmbsr7ich78%40group.calendar.google.com&ctz=Europe%2FBrussels",
    apply:
      "https://jz04xmgcexm.typeform.com/to/HQxBKQdg?typeform-source=apply.regensunite.earth",
    discord: "https://discord.gg/QcfPAJaWb2",
    bogota: "https://regensunite.co/bogota",
    zoom: "https://us06web.zoom.us/j/5686896709",
    brussels: "https://www.regensunite.earth/event/regens-unite-brussels-2023",
    london: "https://www.regensunite.earth/event/regens-unite-london",
  },
  "allforclimate.earth": {
    drive:
      "https://drive.google.com/drive/u/0/folders/1g14Qyf_DmvGuevk4Ks5NgfkWPN5V6H6O",
    zoom: "https://us02web.zoom.us/j/6025635806",
    join: "https://jz04xmgcexm.typeform.com/to/lPbcL9nj?typeform-source=join.allforclimate.earth",
    dework: "https://dework.xyz/o/all-for-clim-5YSFCGX71LR0qVyvqsL2w5",
    bounties: "https://dework.xyz/o/all-for-clim-5YSFCGX71LR0qVyvqsL2w5",
    tasks: "https://dework.xyz/o/all-for-clim-5YSFCGX71LR0qVyvqsL2w5",
    projects: "https://dework.xyz/o/all-for-clim-5YSFCGX71LR0qVyvqsL2w5",
    calendar:
      "https://calendar.google.com/calendar/u/0/embed?src=c_kcbdb0ulem2nivoiugvfbmhjb8@group.calendar.google.com",
    discord: "https://discord.gg/7Cb6Nf2MgM",
  },
};

// proxy to Framer app
const proxy = {
  "commonshub.brussels": "https://able-psychology-281025.framer.app",
};

const proxyRewrites = [];
Object.keys(proxy).forEach((domain) => {
  proxyRewrites.push({
    has: [{ type: "host", value: domain }],
    source: "/",
    destination: proxy[domain],
  });
  proxyRewrites.push({
    has: [{ type: "host", value: domain }],
    source: "/:path*",
    destination: `${proxy[domain]}/:path*`,
  });
});

module.exports = {
  env: {
    OC_GRAPHQL_API: "https://api.opencollective.com/graphql/v1/",
    OC_GRAPHQL_API_V2: "https://api.opencollective.com/graphql/v2/",
  },
  images: {
    remotePatterns: [
      {
        protocol: "https",
        hostname: "**.googleusercontent.com",
      },
      {
        protocol: "https",
        hostname: "**.airtable.com",
      },
      {
        protocol: "https",
        hostname: "**.twimg.com",
      },
    ],
  },
  async redirects() {
    const domains = Object.keys(subdomainsRedirections);
    const redirections = [];
    domains.forEach((domain) => {
      // console.log("\nRedirections for", domain);
      const subdomains = Object.keys(subdomainsRedirections[domain]);
      subdomains.forEach((subdomain) => {
        // console.log(
        // `> ${subdomain}.${domain} -> ${subdomainsRedirections[domain][subdomain]}`
        // );
        redirections.push({
          source: "/(.*)",
          has: [
            {
              type: "host",
              value: `${subdomain}.${domain}`,
            },
          ],
          permanent: false,
          destination: subdomainsRedirections[domain][subdomain],
        });
      });
    });
    return redirections;
  },
  async rewrites() {
    return {
      beforeFiles: proxyRewrites,
      afterFiles: [
        {
          has: [
            {
              type: "host",
              value: "(?<host>.*)",
            },
          ],
          source: "/_next/:path*",
          destination: "/_next/:path*",
        },
        {
          has: [
            {
              type: "host",
              value: "(?<host>.*)",
            },
          ],
          source: "/",
          destination: "/:host",
        },
        {
          has: [
            {
              type: "host",
              value: "(?<host>.*)",
            },
          ],
          source: "/:path*",
          destination: "/:host/:path*",
        },
      ],
    };
  },
  webpack: (config, { isServer }) => {
    if (!isServer) {
      // don't resolve 'fs' module on the client to prevent this error on build --> Error: Can't resolve 'fs'
      config.resolve.fallback = {
        fs: false,
        path: false,
      };
    }

    return config;
  },
};
